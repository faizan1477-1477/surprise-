<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>01/09/2025 ‚Ä¢ For Someone Special ‚ù§Ô∏è | Happy Birthday Interactive Card</title>
    <meta name="description" content="A beautiful, interactive birthday card themed around 01/09/2025, with 3D hearts, confetti, and heartfelt messages. Designed for accessibility, performance, and a professional touch.">
    <meta name="keywords" content="birthday, interactive, card, 3D, confetti, love, special, celebration, web, professional, 01/09/2025, birth date">
    <meta property="og:title" content="01/09/2025 ‚Ä¢ For Someone Special ‚ù§Ô∏è | Happy Birthday Interactive Card">
    <meta property="og:description" content="A beautiful, interactive birthday card themed around 01/08/2025, with 3D hearts, confetti, and heartfelt messages.">
    <meta property="og:type" content="website">
    <meta property="og:image" content="https://cdn.jsdelivr.net/gh/twitter/twemoji@14.0.2/assets/72x72/1f382.png">
    <meta property="og:url" content="https://yourdomain.com/birthday.html">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="01/09/2008 ‚Ä¢ For Someone Special ‚ù§Ô∏è | Happy Birthday Interactive Card">
    <meta name="twitter:description" content="A beautiful, interactive birthday card themed around 01/09/2008, with 3D hearts, confetti, and heartfelt messages.">
    <meta name="twitter:image" content="https://cdn.jsdelivr.net/gh/twitter/twemoji@14.0.2/assets/72x72/1f382.png">
    <link rel="icon" type="image/png" href="https://cdn.jsdelivr.net/gh/twitter/twemoji@14.0.2/assets/72x72/1f382.png">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.11.4/gsap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.11.4/ScrollTrigger.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <style>
        /* Reset and base styles */
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        /* Glassmorphism effect for steps */
        .step {
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 60%, #0f3460 100%);
            box-shadow: 0 10px 32px rgba(26,26,46,0.55), 0 0 24px rgba(255,255,255,0.10);
            backdrop-filter: blur(18px) saturate(1.2);
            border: 1.5px solid rgba(1,9,40,0.18);
        }

        /* Date highlight badge - more attractive, floating, glowing, sparkles */
        .date-badge {
            display: inline-flex;
            align-items: center;
            gap: 0.35em;
            background: linear-gradient(90deg, #111 0%, #ffecd2 30%, #fcb69f 60%, #111 100%);
            color: #fff;
            font-weight: 800;
            font-size: 0.98rem;
            letter-spacing: 0.10em;
            border-radius: 15px;
            padding: 4px 16px;
            margin-bottom: 12px;
            box-shadow: 0 2px 10px #111a, 0 0 0 2px #fff2, 0 0 12px #fcb69f99;
            border: 2px solid #222;
            animation: badgePop 1.2s cubic-bezier(0.16,1,0.3,1), floatBadge 3.2s ease-in-out infinite alternate;
            position: relative;
            z-index: 20;
        }
        .date-badge .sparkle {
            width: 1em;
            height: 1em;
            display: inline-block;
            filter: drop-shadow(0 0 4px #fff7) drop-shadow(0 0 8px #fcb69f) drop-shadow(0 0 8px #000b);
            animation: sparkleSpin 2.2s linear infinite;
        }
        @keyframes badgePop {
            0% { transform: scale(0.7) rotate(-8deg); opacity: 0; }
            60% { transform: scale(1.15) rotate(2deg); opacity: 1; }
            100% { transform: scale(1) rotate(0); opacity: 1; }
        }
        @keyframes floatBadge {
            0% { transform: translateY(0) scale(1); }
            100% { transform: translateY(-10px) scale(1.04); }
        }
        @keyframes sparkleSpin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Animated gradient border for .step */
        .step {
            border: 2.5px solid;
            border-image: linear-gradient(120deg, #111, #fcb69f, #e94560, #1a1a2e, #111 100%) 1;
            box-shadow: 0 0 24px 0 #111a, 0 0 0 6px #fff1, 0 0 18px #fcb69f44;
            position: relative;
            overflow: visible;
        }
        .step::before {
            content: '';
            position: absolute;
            inset: -6px;
            border-radius: 22px;
            z-index: 0;
            background: conic-gradient(from 90deg, #111, #fcb69f, #e94560, #1a1a2e, #111 100%);
            filter: blur(12px) brightness(1.1);
            opacity: 0.7;
            pointer-events: none;
            animation: borderGlow 4s linear infinite;
        }
        @keyframes borderGlow {
            0% { filter: blur(12px) brightness(1.1) hue-rotate(0deg); }
            100% { filter: blur(12px) brightness(1.1) hue-rotate(360deg); }
        }

        /* Neumorphism for buttons */
        .btn {
            box-shadow: 4px 4px 16px #181818, -4px -4px 16px #232526;
        }
        .btn:active {
            box-shadow: 2px 2px 8px #181818, -2px -2px 8px #232526;
        }

        /* SVG morphing animation */
        .morph-svg {
            width: 80px;
            height: 80px;
            display: block;
            margin: 0 auto 18px auto;
        }

        /* Scroll-driven 3D transform */
        .scroll-3d {
            will-change: transform;
            transition: transform 0.7s cubic-bezier(0.16,1,0.3,1);
        }

        /* prefers-reduced-motion: minimize animations */
        @media (prefers-reduced-motion: reduce) {
            *, *::before, *::after {
                animation-duration: 0.01ms !important;
                animation-iteration-count: 1 !important;
                transition-duration: 0.01ms !important;
                scroll-behavior: auto !important;
            }
        }

        /* Subtle fade-in animation for steps */
        .step {
            animation: fadeInStep 1.2s cubic-bezier(0.16, 1, 0.3, 1) both;
        }
        @keyframes fadeInStep {
            0% {
                opacity: 0;
                transform: translateY(30px) scale(0.98);
            }
            100% {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }

        /* Button micro-interaction: ripple effect */
        .btn:active::after {
            content: '';
            position: absolute;
            left: 50%;
            top: 50%;
            width: 0;
            height: 0;
            background: rgba(255,182,213,0.18);
            border-radius: 100%;
            transform: translate(-50%, -50%);
            animation: ripple 0.5s linear;
            z-index: 1;
        }
        @keyframes ripple {
            to {
                width: 200%;
                height: 200%;
                opacity: 0;
            }
        }

        html {
            scroll-behavior: smooth;
        }

        body {
            font-family: 'Inter', Arial, Helvetica, sans-serif;
            background: linear-gradient(135deg, #181818, #232526, #0a0a0a);
            min-height: 100vh;
            overflow-x: hidden;
            overflow-y: auto;
            -webkit-overflow-scrolling: touch;
            touch-action: pan-y pinch-zoom;
            color: #f5f5f5;
            user-select: none;
            -webkit-tap-highlight-color: rgba(255,255,255,0.1);
        }

        #app {
            position: relative;
            width: 100%;
            min-height: 100vh;
            overflow: visible;
        }

        #content {
            position: relative;
            z-index: 10;
            width: 100%;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            padding: 24px 12px;
        }

        .step {
            position: relative;
            width: 100%;
            max-width: 800px;
            padding: 40px 20px;
            background: rgba(28, 28, 28, 0.92);
            backdrop-filter: blur(14px);
            border: 1.5px solid rgba(255, 255, 255, 0.12);
            border-radius: 24px;
            box-shadow: 0 10px 32px rgba(0, 0, 0, 0.55), 0 0 24px rgba(255, 255, 255, 0.07);
            text-align: center;
            opacity: 0;
            transform: translateY(20px);
            transition: all 0.8s cubic-bezier(0.16, 1, 0.3, 1);
            pointer-events: none;
            margin: 24px auto;
            display: none;
        }

        .step.active {
            opacity: 1;
            transform: translateY(0);
            pointer-events: all;
            display: block;
        }

        .btn {
            position: relative;
            overflow: hidden;
            background: linear-gradient(135deg, #000000, #2d2d2d, #1a1a1a);
            color: #fff;
            border: 2px solid rgba(255, 255, 255, 0.22);
            padding: 16px 36px;
            border-radius: 48px;
            font-weight: 700;
            cursor: pointer;
            margin-top: 22px;
            box-shadow: 0 4px 18px rgba(0, 0, 0, 0.65), 0 0 22px rgba(255, 255, 255, 0.13);
            transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1);
            font-size: 17px;
            min-height: 48px;
            touch-action: manipulation;
            outline: none;
            touch-action: manipulation;
            -webkit-tap-highlight-color: rgba(255,255,255,0.15);
        }
        .btn:focus-visible {
            outline: 2.5px solid #ffb6d5;
            outline-offset: 2px;
            box-shadow: 0 0 0 4px rgba(255,182,213,0.18);
        }

        .btn:hover {
            transform: translateY(-3px) scale(1.04);
            box-shadow: 0 8px 28px rgba(0, 0, 0, 0.85), 0 0 36px rgba(255, 255, 255, 0.22);
            border-color: rgba(255, 255, 255, 0.38);
            background: linear-gradient(135deg, #232526, #1a1a1a, #2d2d2d);
        }

        .btn:active {
            transform: translateY(0) scale(1);
        }

        .text-gradient {
            background: linear-gradient(135deg, #ffffff, #d1d1d1, #a0a0a0);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
        }

        .heart-beat {
            animation: heartbeat 1.5s ease-in-out infinite;
        }

        @keyframes heartbeat {
            0%, 50%, 100% { transform: scale(1); }
            25%, 75% { transform: scale(1.1); }
        }

        .emoji {
            font-size: 3rem;
            margin-bottom: 20px;
            display: inline-block;
            filter: drop-shadow(0 2px 6px rgba(255,255,255,0.08));
        }

        .reason-card {
            background: linear-gradient(135deg, #2d2d2d, #1a1a1a);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 22px;
            margin: 12px;
            box-shadow: 0 6px 18px rgba(0, 0, 0, 0.45), 0 0 12px rgba(255, 255, 255, 0.07);
            transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .reason-card:hover {
            transform: translateY(-7px) scale(1.03);
            box-shadow: 0 12px 32px rgba(0, 0, 0, 0.7), 0 0 24px rgba(255, 255, 255, 0.13);
            border-color: rgba(255, 255, 255, 0.22);
        }

        #progress-container {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            width: 80%;
            max-width: 400px;
            height: 6px;
            background: rgba(20, 20, 20, 0.8);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 3px;
            z-index: 100;
        }

        #progress-bar {
            height: 100%;
            width: 0%;
            background: linear-gradient(90deg, #000000, #2d2d2d, #ffffff);
            border-radius: 3px;
            transition: width 0.5s ease;
            box-shadow: 0 0 10px rgba(255, 255, 255, 0.3);
        }

        #canvas-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 1;
            pointer-events: none;
        }

        /* Mobile optimizations */
        @media (max-width: 768px) {
            .step {
                padding: 22px 8px;
                margin: 8px;
            }

            .emoji {
                font-size: 2.2rem;
            }

            .btn {
                padding: 10px 18px;
                font-size: 15px;
                min-width: 120px;
            }

            .reason-card {
                margin: 6px;
                padding: 12px;
            }

            .memory-photo {
                width: 160px;
                height: 160px;
            }
        }
        @media (pointer: coarse) {
            .btn {
                min-height: 56px;
                font-size: 17px;
            }
        }

        /* Performance indicator */
        .performance-warning {
            position: fixed;
            top: 60px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(40, 40, 40, 0.95);
            color: #ffffff;
            border: 1px solid rgba(255, 255, 255, 0.2);
            padding: 10px 15px;
            border-radius: 10px;
            font-size: 14px;
            z-index: 200;
            display: none;
        }

        /* Fallback for no-3d devices */
        .no-3d #canvas-container {
            background: radial-gradient(circle at center, rgba(50, 50, 50, 0.3), transparent);
        }

        /* Memory photo placeholder */
        .memory-photo {
            width: 240px;
            height: 240px;
            background: linear-gradient(45deg, #2d2d2d, #000000);
            border: 2px solid rgba(255, 255, 255, 0.2);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 4rem;
            margin: 0 auto 20px;
            box-shadow: 0 0 20px rgba(255, 255, 255, 0.1);
            transition: box-shadow 0.4s cubic-bezier(0.4,0,0.2,1), transform 0.4s cubic-bezier(0.4,0,0.2,1);
            overflow: hidden;
        }
        .memory-photo:hover {
            box-shadow: 0 0 40px 10px #ffb6d5, 0 0 20px #fff;
            transform: scale(1.08) rotate(-3deg);
        }

        /* Update text colors for dark theme */
        .step h1, .step h2, .step h3 {
            color: #f5f5f5;
        }

        .step p {
            color: #e0e0e0;
        }

        .reason-card h3 {
            color: #f5f5f5;
        }

        .reason-card p {
            color: #cccccc;
        }

        /* Update specific text colors */
        .text-pink-600 {
            color: #ffb6d5 !important;
        }

        .text-gray-700 {
            color: #e0e0e0 !important;
        }

        .text-gray-500 {
            color: #b0b0b0 !important;
        }

        /* Memory section styling */
        .bg-gradient-to-r {
            background: linear-gradient(to right, #2d2d2d, #1a1a1a) !important;
            border: 1.5px solid rgba(255, 255, 255, 0.13);
        }
    </style>
</head>

<body>
    <div id="app">
        <div id="canvas-container"></div>
        
        <div class="performance-warning" id="performance-warning">
            Optimizing for your device...
        </div>

        <div id="progress-container" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100" aria-label="Progress">
            <div id="progress-bar"></div>
        </div>

        <div id="content" aria-live="polite">
            <!-- Step 1: Initial Reveal -->
            <div class="step active" id="step1">
                <div class="date-badge">
                    <span class="sparkle">‚ú®</span>
                    01 / 09 / 2025
                    <span class="sparkle">‚ú®</span>
                </div>
                <svg class="morph-svg" id="morphHeart" viewBox="0 0 100 100" fill="#e94560" xmlns="http://www.w3.org/2000/svg">
                    <path id="morphPath" d="M50 80 Q20 60 20 35 Q20 20 40 20 Q50 20 50 30 Q50 20 60 20 Q80 20 80 35 Q80 60 50 80 Z"/>
                </svg>
                <h1 class="text-4xl md:text-5xl font-bold mb-6 text-gradient">Hey Beautiful</h1>
                <p class="text-xl text-gray-700 mb-8">I made something special for you...</p>
                <button class="btn" id="start-btn" aria-label="Begin the experience">Let's Begin</button>
            </div>

            <!-- Step 2: Birthday Message -->
            <div class="step" id="step2">
                <div class="emoji" role="img" aria-label="party popper">üéâ</div>
                <h2 class="text-3xl md:text-4xl font-bold mb-6 text-gradient">Happy Birthday ASHRA !</h2>
                <p class="text-lg text-gray-700 mb-6">
                    Barakallahu fi umrik ! May Allah bless you with a life filled with faith, happiness, and prosperity. Your presence is a true blessing.
                </p>
                <button class="btn" id="next-btn-2" aria-label="See what makes you special">What makes you special?</button>
            </div>

            <!-- Step 3: Reasons You're Amazing -->
            <div class="step" id="step3">
                <h2 class="text-3xl md:text-4xl font-bold mb-8 text-gradient">Here's why you're incredible</h2>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-8">
                    <div class="reason-card">
                        <div class="emoji text-3xl" role="img" aria-label="sparkles">‚ú®</div>
                        <h3 class="text-xl font-bold mb-2 text-pink-600">Your Kindness</h3>
                        <p class="text-gray-700">The way you care about others is truly inspiring. You have the biggest heart.</p>
                    </div>
                    <div class="reason-card">
                        <div class="emoji text-3xl" role="img" aria-label="smiling face">üòä</div>
                        <h3 class="text-xl font-bold mb-2 text-pink-600">Your Smile</h3>
                        <p class="text-gray-700">It lights up every room you enter and stays in my mind all day.</p>
                    </div>
                    <div class="reason-card">
                        <div class="emoji text-3xl" role="img" aria-label="glowing star">üåü</div>
                        <h3 class="text-xl font-bold mb-2 text-pink-600">Your Spirit</h3>
                        <p class="text-gray-700">Your passion and energy are contagious. You make life exciting!</p>
                    </div>
                </div>
                <button class="btn" id="next-btn-3">A Little Surprise</button>
            </div>

            <!-- Step 4: Memory Lane -->
            <div class="step" id="step4">
                <div class="emoji" role="img" aria-label="camera">ü¶ã </div>
                <h2 class="text-3xl md:text-4xl font-bold mb-6 text-gradient"> Remember !</h2>
                <div class="bg-gradient-to-r from-pink-200 to-rose-200 rounded-xl p-8 mb-8 flex flex-col justify-center items-center" aria-label="Memory section">
                    <div class="memory-photo" role="img" aria-label="two hearts">
                        <img alt="Free Photo beautiful anime kid cartoon scene" fetchpriority="high" width="626" height="417" decoding="async" data-nimg="1" class="block rounded object-cover object-center h-auto w-full" src="https://img.freepik.com/free-photo/beautiful-anime-kid-cartoon-scene_23-2151035184.jpg?ga=GA1.1.1393185155.1743744931&amp;semt=ais_hybrid&amp;w=740" style="color: transparent;"style="width:100%;height:100%;object-fit:cover;object-position:60% 40%;border-radius:50%;display:block;image-rendering:auto;"style="width:100%;height:100%;object-fit:cover;object-position:60% 40%;border-radius:50%;display:block;image-rendering:auto;">
                    </div>
                    <p class="text-lg text-gray-700 italic mt-2"></p>
                </div>
                <p class="text-lg text-gray-700 mb-6">
                    Alhamdulillah for the moments we share. May Allah keep our hearts united in love and grant us many more cherished memories together.
                </p>
                <button class="btn" id="next-btn-4">One Last Thing</button>
            </div>

            <!-- Step 5: Final Wish -->
            <div class="step" id="step5">
                <div class="emoji" role="img" aria-label="birthday cake">üéÇ</div>
                <h2 class="text-3xl md:text-4xl font-bold mb-6 text-gradient">My Birthday Wish For You</h2>
                <p class="text-lg text-gray-700 mb-8">
                    On your birthday, I pray that Allah grants you joy, success, and peace in this life and the hereafter. May you always be surrounded by His mercy and love.
                </p>
                <p class="text-xl font-semibold text-pink-600 mb-8">
                    Happy Birthday to you <span role="img" aria-label="red heart"> "üíï" </span>
                </p>
                <button class="btn" id="confetti-btn" aria-label="Celebrate with confetti">Celebrate!</button>
                <canvas id="balloon-canvas" style="position:fixed;left:0;top:0;width:100vw;height:100vh;pointer-events:none;z-index:999;display:none;"></canvas>
                <p class="mt-8 text-gray-500">Made with <span role="img" aria-label="red heart">‚ù§Ô∏è</span> just for you</p>
            </div>
        </div>
    </div>

    <script>
    // --- GSAP Scroll-driven 3D transform for .memory-photo ---
    document.addEventListener('DOMContentLoaded', () => {
        if (window.gsap && window.ScrollTrigger) {
            gsap.registerPlugin(ScrollTrigger);
            gsap.to('.memory-photo', {
                scrollTrigger: {
                    trigger: '.memory-photo',
                    start: 'top 80%',
                    end: 'bottom 20%',
                    scrub: 1
                },
                rotateY: 360,
                scale: 1.2,
                ease: 'power2.inOut',
            });
        }
    });

    // --- SVG Path Morphing Animation (anime.js) ---
    document.addEventListener('DOMContentLoaded', () => {
        if (window.anime) {
            const morphPath = document.getElementById('morphPath');
            if (morphPath) {
                anime({
                    targets: morphPath,
                    d: [
                        { value: 'M50 80 Q20 60 20 35 Q20 20 40 20 Q50 20 50 30 Q50 20 60 20 Q80 20 80 35 Q80 60 50 80 Z' },
                        { value: 'M50 80 Q10 60 10 35 Q10 10 40 10 Q50 10 50 30 Q50 10 60 10 Q90 10 90 35 Q90 60 50 80 Z' },
                        { value: 'M50 80 Q20 60 20 35 Q20 20 40 20 Q50 20 50 30 Q50 20 60 20 Q80 20 80 35 Q80 60 50 80 Z' }
                    ],
                    duration: 3200,
                    direction: 'alternate',
                    loop: true,
                    easing: 'easeInOutQuad',
                    update: function(anim) {
                        // Animate badge color with morph
                        const badge = document.querySelector('.date-badge');
                        if (badge) {
                            const t = anim.progress / 100;
                        badge.style.background = `linear-gradient(90deg, #111 ${(1-t)*100}%, #ffecd2 ${(1-t)*80}%, #fcb69f ${(t*100)/2}%, #e94560 ${t*100}%, #111 ${t*100}%)`;
                        }
                    }
                });
            }
        }
    });
    /**
     * Birthday Interactive Page Script
     * Refactored for clarity, maintainability, and performance.
     * Sections: Device Detection, 3D Animation, Step Management, Effects, Accessibility, Initialization
     */

    // --- Device and Performance Detection ---
    // Cache device detection results
    const deviceInfo = {
        isMobile: /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent),
        isLowEnd: (navigator.hardwareConcurrency || 2) < 4 || (navigator.deviceMemory || 2) < 4,
        supportsWebGL: (() => {
            try {
                const canvas = document.createElement('canvas');
                const context = canvas.getContext('webgl') || canvas.getContext('experimental-webgl');
                return !!context;
            } catch (e) {
                return false;
            }
        })()
    };
    
    const { isMobile, isLowEnd, supportsWebGL } = deviceInfo;

    // --- Three.js 3D Heart Animation ---
    let scene, camera, renderer, hearts = [];
    let animationId;
    const performanceMonitor = {
        frameCount: 0,
        lastTime: 0,
        fps: 60
    };

    /**
     * Monitor animation performance and reduce effects if needed.
     */
    function monitorPerformance() {
        const now = performance.now();
        performanceMonitor.frameCount++;
        if (now - performanceMonitor.lastTime >= 1000) {
            performanceMonitor.fps = performanceMonitor.frameCount;
            performanceMonitor.frameCount = 0;
            performanceMonitor.lastTime = now;
            // Show warning if performance is poor
            if (performanceMonitor.fps < 30 && hearts.length > 5) {
                showPerformanceWarning();
                reduceHearts();
            }
        }
    }

    /**
     * Show a temporary performance warning.
     */
    function showPerformanceWarning() {
        const warning = document.getElementById('performance-warning');
        warning.style.display = 'block';
        setTimeout(() => {
            warning.style.display = 'none';
        }, 3000);
    }

    /**
     * Remove half of the hearts to improve performance.
     */
    function reduceHearts() {
        const heartsToRemove = Math.floor(hearts.length / 2);
        for (let i = 0; i < heartsToRemove; i++) {
            const heart = hearts.pop();
            if (heart) {
                scene.remove(heart);
                // Properly dispose of geometry and material to prevent memory leaks
                if (heart.geometry) heart.geometry.dispose();
                if (heart.material) heart.material.dispose();
            }
        }
    }

    /**
     * Initialize Three.js scene, camera, renderer, and hearts.
     */
    function initThreeJS() {
        if (!supportsWebGL) {
            document.body.classList.add('no-3d');
            return;
        }
        try {
            const container = document.getElementById('canvas-container');
            // Scene
            scene = new THREE.Scene();
            // Camera
            camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
            camera.position.z = 5;
            // Renderer
            renderer = new THREE.WebGLRenderer({
                alpha: true,
                antialias: !isMobile && !isLowEnd,
                powerPreference: isLowEnd ? "low-power" : "default"
            });
            renderer.setSize(window.innerWidth, window.innerHeight);
            renderer.setPixelRatio(Math.min(window.devicePixelRatio, isMobile ? 1.5 : 2));
            container.appendChild(renderer.domElement);
            // Hearts
            createHearts();
            // Animation loop
            animate();
            // Responsive resize
            window.addEventListener('resize', onWindowResize, false);
        } catch (error) {
            console.warn('3D initialization failed:', error);
            document.body.classList.add('no-3d');
        }
    }

    /**
     * Create animated heart meshes and add to scene.
     */
    function createHearts() {
        const heartCount = isMobile ? 15 : (isLowEnd ? 20 : 30);
        for (let i = 0; i < heartCount; i++) {
            // Heart shape
            const heartShape = new THREE.Shape();
            const x = 0, y = 0;
            heartShape.moveTo(x + 5, y + 5);
            heartShape.bezierCurveTo(x + 5, y + 5, x + 4, y, x, y);
            heartShape.bezierCurveTo(x - 6, y, x - 6, y + 3.5, x - 6, y + 3.5);
            heartShape.bezierCurveTo(x - 6, y + 5.5, x - 4, y + 7.7, x, y + 10);
            heartShape.bezierCurveTo(x + 4, y + 7.7, x + 6, y + 5.5, x + 6, y + 3.5);
            heartShape.bezierCurveTo(x + 6, y + 3.5, x + 6, y, x, y);
            const geometry = new THREE.ShapeGeometry(heartShape);
            const material = new THREE.MeshBasicMaterial({
                color: new THREE.Color().setHSL(Math.random() * 0.1, 0.7, 0.5),
                transparent: true,
                opacity: 0.7
            });
            const heart = new THREE.Mesh(geometry, material);
            // Random position and rotation
            heart.position.x = (Math.random() - 0.5) * 20;
            heart.position.y = (Math.random() - 0.5) * 20;
            heart.position.z = (Math.random() - 0.5) * 10;
            heart.rotation.z = Math.random() * Math.PI * 2;
            // Animation properties
            heart.userData = {
                speedY: Math.random() * 0.02 + 0.01,
                speedRotation: Math.random() * 0.02 + 0.01,
                amplitude: Math.random() * 0.5 + 0.5
            };
            scene.add(heart);
            hearts.push(heart);
        }
    }

    /**
     * Animation loop for hearts and camera.
     */
    function animate() {
        if (!renderer) return;
        animationId = requestAnimationFrame(animate);
        monitorPerformance();
        // Animate hearts
        hearts.forEach(heart => {
            heart.position.y += heart.userData.speedY;
            heart.rotation.z += heart.userData.speedRotation;
            heart.position.x += Math.sin(Date.now() * 0.001 + heart.position.y) * 0.001 * heart.userData.amplitude;
            if (heart.position.y > 15) {
                heart.position.y = -15;
                heart.position.x = (Math.random() - 0.5) * 20;
            }
        });
        // Rotate camera slightly
        if (camera) {
            camera.position.x = Math.sin(Date.now() * 0.0005) * 0.5;
            camera.lookAt(scene.position);
        }
        renderer.render(scene, camera);
    }

    /**
     * Responsive resize handler for Three.js.
     */
    function onWindowResize() {
        if (!camera || !renderer) return;
        camera.aspect = window.innerWidth / window.innerHeight;
        camera.updateProjectionMatrix();
        renderer.setSize(window.innerWidth, window.innerHeight);
    }

    // --- Step Management ---
    let currentStep = 1;
    const totalSteps = 5;

    // --- Micro-interaction: Animate step transitions with GSAP ---
    function animateStepIn(stepId) {
        if (window.gsap) {
            gsap.fromTo(`#${stepId}`, { y: 40, opacity: 0 }, { y: 0, opacity: 1, duration: 0.9, ease: 'power3.out' });
        }
    }

    /**
     * Update the progress bar for steps.
     */
    function updateProgress() {
        const progress = (currentStep / totalSteps) * 100;
        const bar = document.getElementById('progress-bar');
        bar.style.width = progress + '%';
        // Accessibility: update aria-valuenow
        bar.parentElement.setAttribute('aria-valuenow', Math.round(progress));
    }

    /**
     * Move to the next step in the UI.
     */
    function nextStep() {
        if (currentStep >= totalSteps) return;
        
        try {
            // Hide current step
            const currentStepEl = document.getElementById(`step${currentStep}`);
            if (currentStepEl) {
                currentStepEl.classList.remove('active');
            }
            
            // Show next step
            currentStep++;
            setTimeout(() => {
                const nextStepDiv = document.getElementById(`step${currentStep}`);
                if (nextStepDiv) {
                    nextStepDiv.classList.add('active');
                    animateStepIn(`step${currentStep}`);
                    // Accessibility: focus first button in new step
                    const btn = nextStepDiv.querySelector('.btn');
                    if (btn) btn.focus();
                }
            }, 200);
            updateProgress();
        } catch (error) {
            console.warn('Error in nextStep:', error);
        }
    }

    // --- Event Listeners for Step Buttons ---
    document.getElementById('start-btn').addEventListener('click', () => {
        nextStep();
        triggerHeartExplosion();
    });
    document.getElementById('next-btn-2').addEventListener('click', () => {
        nextStep();
        triggerHeartExplosion();
    });
    document.getElementById('next-btn-3').addEventListener('click', () => {
        nextStep();
        triggerHeartExplosion();
    });
    document.getElementById('next-btn-4').addEventListener('click', () => {
        nextStep();
        triggerHeartExplosion();
    });
    document.getElementById('confetti-btn').addEventListener('click', () => {
        triggerConfetti();
        triggerHeartExplosion();
        triggerBalloonsAndSparkles();
    });
    // --- Unique Celebration Animation: Balloons and Sparkles ---
    function triggerBalloonsAndSparkles() {
        const canvas = document.getElementById('balloon-canvas');
        if (!canvas) return;
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;
        canvas.style.display = 'block';
        const ctx = canvas.getContext('2d');
        const balloons = [];
        const sparkles = [];
        const colors = ['#e94560','#fcb69f','#ffecd2','#fff','#111','#0f3460','#ffb6d5'];
        // Create balloons
        for(let i=0;i<12;i++){
            balloons.push({
                x: Math.random()*canvas.width,
                y: canvas.height+Math.random()*100,
                r: 28+Math.random()*18,
                color: colors[Math.floor(Math.random()*colors.length)],
                speed: 1.2+Math.random()*1.5,
                sway: Math.random()*2+1,
                swayPhase: Math.random()*Math.PI*2
            });
        }
        // Create sparkles
        for(let i=0;i<32;i++){
            sparkles.push({
                x: Math.random()*canvas.width,
                y: Math.random()*canvas.height*0.7,
                r: 1.5+Math.random()*2.5,
                color: colors[Math.floor(Math.random()*colors.length)],
                alpha: 0.7+Math.random()*0.3,
                dx: (Math.random()-0.5)*0.7,
                dy: -Math.random()*0.7-0.2
            });
        }
        let frame = 0;
        function draw() {
            ctx.clearRect(0,0,canvas.width,canvas.height);
            // Balloons
            balloons.forEach(b=>{
                ctx.save();
                ctx.globalAlpha=0.85;
                ctx.beginPath();
                ctx.ellipse(b.x+Math.sin(frame/30+b.swayPhase)*b.sway*8, b.y, b.r*0.7, b.r, 0, 0, Math.PI*2);
                ctx.fillStyle=b.color;
                ctx.shadowColor='#fff';
                ctx.shadowBlur=18;
                ctx.fill();
                // String
                ctx.globalAlpha=0.5;
                ctx.beginPath();
                ctx.moveTo(b.x, b.y+b.r);
                ctx.bezierCurveTo(b.x+8, b.y+b.r+18, b.x-8, b.y+b.r+38, b.x, b.y+b.r+48);
                ctx.strokeStyle='#fff8';
                ctx.lineWidth=2;
                ctx.stroke();
                ctx.restore();
                b.y -= b.speed;
                b.x += Math.sin(frame/30+b.swayPhase)*b.sway;
            });
            // Sparkles
            sparkles.forEach(s=>{
                ctx.save();
                ctx.globalAlpha=s.alpha;
                ctx.beginPath();
                ctx.arc(s.x, s.y, s.r, 0, Math.PI*2);
                ctx.fillStyle=s.color;
                ctx.shadowColor='#fff';
                ctx.shadowBlur=10;
                ctx.fill();
                ctx.restore();
                s.x += s.dx;
                s.y += s.dy;
                s.alpha -= 0.008;
            });
            frame++;
        }
        let animId;
        function animate() {
            draw();
            if (frame<220) {
                animId = requestAnimationFrame(animate);
            } else {
                canvas.style.display = 'none';
                ctx.clearRect(0,0,canvas.width,canvas.height);
            }
        }
        animate();
    }

    // --- Effects ---
    /**
     * Temporarily speed up hearts for a "burst" effect.
     */
    function triggerHeartExplosion() {
        if (hearts.length > 0) {
            hearts.forEach(heart => {
                heart.userData.speedY *= 2;
                heart.userData.speedRotation *= 3;
            });
            setTimeout(() => {
                hearts.forEach(heart => {
                    heart.userData.speedY /= 2;
                    heart.userData.speedRotation /= 3;
                });
            }, 1000);
        }
    }

    /**
     * Launch confetti animation.
     */
    function triggerConfetti() {
        const duration = 3000;
        const animationEnd = Date.now() + duration;
        const defaults = { startVelocity: 30, spread: 360, ticks: 60, zIndex: 1000 };
        function randomInRange(min, max) {
            return Math.random() * (max - min) + min;
        }
        const interval = setInterval(function() {
            const timeLeft = animationEnd - Date.now();
            if (timeLeft <= 0) {
                return clearInterval(interval);
            }
            const particleCount = 50 * (timeLeft / duration);
            confetti(Object.assign({}, defaults, {
                particleCount,
                origin: { x: randomInRange(0.1, 0.3), y: Math.random() - 0.2 }
            }));
            confetti(Object.assign({}, defaults, {
                particleCount,
                origin: { x: randomInRange(0.7, 0.9), y: Math.random() - 0.2 }
            }));
        }, 250);
    }

    // --- Touch Event Handling for Mobile ---
    let touchStartY = 0;
    let touchEndY = 0;
    document.addEventListener('touchstart', e => {
        touchStartY = e.changedTouches[0].screenY;
    }, { passive: true });
    document.addEventListener('touchend', e => {
        touchEndY = e.changedTouches[0].screenY;
        handleSwipe();
    }, { passive: true });

    /**
     * Handle swipe gestures for step navigation.
     */
    function handleSwipe() {
        const swipeThreshold = 50;
        const diff = touchStartY - touchEndY;
        if (Math.abs(diff) > swipeThreshold) {
            if (diff > 0 && currentStep < totalSteps) {
                // Swipe up - next step
                nextStep();
            }
        }
    }

    // --- Initialization ---
    document.addEventListener('DOMContentLoaded', () => {
        updateProgress();
        // Small delay to ensure smooth loading
        setTimeout(() => {
            initThreeJS();
        }, 100);
        // Accessibility: Keyboard navigation for steps
        document.addEventListener('keydown', function (e) {
            if (e.key === "ArrowRight" || e.key === "Enter" || e.key === " ") {
                // Next step on right arrow, enter, or space
                nextStep();
            }
            if (e.key === "ArrowLeft") {
                // Go back a step (if needed in future)
                // Optionally implement previous step
            }
        });
        // Focus first button for screen readers
        const firstBtn = document.querySelector('.step.active .btn');
        if (firstBtn) firstBtn.focus();
    });

    // --- Cleanup on Page Unload ---
    window.addEventListener('beforeunload', () => {
        if (animationId) {
            cancelAnimationFrame(animationId);
        }
        if (renderer) {
            renderer.dispose();
        }
    });

    // --- Intersection Observer for Performance Optimization ---
    if ('IntersectionObserver' in window) {
        const observer = new IntersectionObserver((entries) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    if (renderer && !animationId) {
                        animate();
                    }
                } else {
                    if (animationId) {
                        cancelAnimationFrame(animationId);
                        animationId = null;
                    }
                }
            });
        });
        const canvasContainer = document.getElementById('canvas-container');
        if (canvasContainer) {
            observer.observe(canvasContainer);
        }
    }
    </script>
</body>

</html>

